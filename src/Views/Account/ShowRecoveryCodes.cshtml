@model RecoveryCodesViewModel
@{
    ViewData["Title"] = "Recovery Codes";
}

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow">
            <div class="card-body">
                <h2 class="card-title text-center mb-4">Your Recovery Codes</h2>

                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show">
                        @TempData["Success"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <div class="alert alert-danger mb-4" role="alert">
                    <strong>Important: Save these codes now!</strong>
                    <p class="mb-0">These recovery codes will only be shown once. Store them in a secure location.</p>
                </div>

                <div class="card bg-light mb-4" id="recovery-codes">
                    <div class="card-body">
                        <div class="row">
                            @for (int i = 0; i < Model.RecoveryCodes.Length; i++)
                            {
                                <div class="col-md-6 mb-2">
                                    <div class="input-group">
                                        <span class="input-group-text">@(i + 1)</span>
                                        <input type="text" class="form-control font-monospace" value="@Model.RecoveryCodes[i]" readonly />
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 mb-3">
                    <button type="button" class="btn btn-outline-primary" onclick="copyAllCodes()">
                        Copy All Codes
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="printCodes()">
                        Print Codes
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="downloadCodes()">
                        Download as Text File
                    </button>
                </div>

                <div class="alert alert-info mb-4">
                    <h6>How to use recovery codes:</h6>
                    <ul class="mb-0">
                        <li>Each code can only be used once</li>
                        <li>Use a recovery code if you lose access to your authenticator app</li>
                        <li>Enter a recovery code instead of the 6-digit code when logging in</li>
                        <li>You can regenerate new codes from your account settings</li>
                    </ul>
                </div>

                <a href="/Admin/Dashboard" class="btn btn-primary w-100">I Have Saved My Codes - Continue</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function copyAllCodes() {
            const codes = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RecoveryCodes));
            const text = codes.join('\n');
            navigator.clipboard.writeText(text).then(() => {
                alert('All recovery codes copied to clipboard!');
            });
        }

        function printCodes() {
            window.print();
        }

        function downloadCodes() {
            const codes = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RecoveryCodes));
            const text = 'Two-Factor Authentication Recovery Codes\n\n' +
                         codes.map((code, i) => `${i + 1}. ${code}`).join('\n') +
                         '\n\nImportant: Keep these codes secure. Each code can only be used once.';

            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'recovery-codes.txt';
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
}
